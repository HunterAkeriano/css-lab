import{d as j,u as x,h as r,i as B,j as R,k as H,c as d,o as p,a,t as s,e as i,l as A,m as G,p as F,v as T}from"./index-DAd-KxhA.js";import{a as y}from"./auth-CoLzQyyB.js";const z={class:"profile-page"},Z={class:"profile-page__container"},$={class:"profile-page__header"},q={class:"profile-page__title"},J={class:"profile-page__subtitle"},K={class:"profile-page__content"},Q={class:"profile-page__avatar-section"},W={class:"profile-avatar"},X=["src"],Y={key:1,class:"profile-avatar__placeholder"},ee={class:"profile-avatar__initials"},ae={class:"profile-avatar__controls"},le=["disabled"],se=["disabled"],te={class:"profile-avatar__hint"},oe={key:1,class:"profile-avatar__error"},ie={class:"profile-form__field"},ne={class:"profile-form__label",for:"name"},re=["disabled"],ue={class:"profile-form__field"},ce={class:"profile-form__label",for:"email"},_e={class:"profile-form__field"},de={class:"profile-form__label"},pe={class:"profile-form__text"},ve=["disabled"],fe={key:0,class:"profile-form__error"},me={key:1,class:"profile-form__success"},Re=j({__name:"ProfilePage",setup(ge){const{t:l}=x(),h=r(null),u=r(null),v=r(null),m=r(!1),g=r(!1),_=r(null),E=r(null),f=r(!1),n=r(null),c=B({name:"",email:""}),I=r(""),k=R(()=>{var e,t;return(e=n.value)!=null&&e.name?n.value.name.split(" ").map(o=>o[0]).join("").toUpperCase().slice(0,2):(t=n.value)!=null&&t.email?n.value.email[0].toUpperCase():"?"}),P=R(()=>{var e;return v.value||((e=n.value)==null?void 0:e.avatarUrl)||null}),C=R(()=>{var t;return(t=n.value)!=null&&t.createdAt?new Date(n.value.createdAt).toLocaleDateString(void 0,{year:"numeric",month:"long"}):""}),L=R(()=>c.name!==I.value);async function D(){try{const e=await y.getProfile();n.value=e.user,c.name=e.user.name||"",c.email=e.user.email,I.value=e.user.name||""}catch(e){console.error("Failed to load profile",e)}}function V(e){var S;const o=(S=e.target.files)==null?void 0:S[0];if(_.value=null,f.value=!1,!o){u.value=null,v.value=null;return}if(!["image/jpeg","image/jpg","image/png","image/gif"].includes(o.type)){_.value=l("PROFILE.UPLOAD_FORMAT_ERROR"),u.value=null,v.value=null;return}if(o.size>2*1024*1024){_.value=l("PROFILE.UPLOAD_SIZE_ERROR"),u.value=null,v.value=null;return}u.value=o;const O=new FileReader;O.onload=M=>{var U;v.value=(U=M.target)==null?void 0:U.result},O.readAsDataURL(o)}async function N(){if(u.value){m.value=!0,_.value=null,f.value=!1;try{const e=await y.uploadAvatar(u.value);n.value=e.user,u.value=null,v.value=null,h.value&&(h.value.value="")}catch(e){_.value=(e==null?void 0:e.message)||l("PROFILE.UPLOAD_ERROR")}finally{m.value=!1}}}async function w(){if(L.value){g.value=!0,E.value=null,f.value=!1;try{const e=await y.updateProfile({name:c.name||void 0});n.value=e.user,I.value=e.user.name||"",f.value=!0,setTimeout(()=>{f.value=!1},3e3)}catch(e){E.value=(e==null?void 0:e.message)||l("VALIDATION.SERVER_ERROR")}finally{g.value=!1}}}return H(()=>{D()}),(e,t)=>(p(),d("div",z,[a("div",Z,[a("div",$,[a("h1",q,s(i(l)("PROFILE.TITLE")),1),a("p",J,s(i(l)("PROFILE.SUBTITLE")),1)]),a("div",K,[a("div",Q,[a("div",W,[P.value?(p(),d("img",{key:0,src:P.value,alt:"Avatar",class:"profile-avatar__image"},null,8,X)):(p(),d("div",Y,[a("span",ee,s(k.value),1)]))]),a("div",ae,[a("input",{ref_key:"fileInputRef",ref:h,type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif",class:"profile-avatar__file-input",onChange:V},null,544),a("button",{type:"button",class:"profile-avatar__upload-btn",onClick:t[0]||(t[0]=o=>{var b;return(b=h.value)==null?void 0:b.click()}),disabled:m.value},s(i(l)("PROFILE.UPLOAD_AVATAR")),9,le),u.value?(p(),d("button",{key:0,type:"button",class:"profile-avatar__confirm-btn",onClick:N,disabled:m.value},s(m.value?i(l)("PROFILE.SAVING"):i(l)("PROFILE.SAVE_CHANGES")),9,se)):A("",!0),a("p",te,s(i(l)("PROFILE.UPLOAD_HINT")),1),_.value?(p(),d("p",oe,s(_.value),1)):A("",!0)])]),a("form",{class:"profile-form",onSubmit:G(w,["prevent"])},[a("div",ie,[a("label",ne,s(i(l)("AUTH.NAME")),1),F(a("input",{id:"name","onUpdate:modelValue":t[1]||(t[1]=o=>c.name=o),type:"text",class:"profile-form__input",disabled:g.value},null,8,re),[[T,c.name]])]),a("div",ue,[a("label",ce,s(i(l)("AUTH.EMAIL")),1),F(a("input",{id:"email","onUpdate:modelValue":t[2]||(t[2]=o=>c.email=o),type:"email",class:"profile-form__input",disabled:""},null,512),[[T,c.email]])]),a("div",_e,[a("label",de,s(i(l)("PROFILE.MEMBER_SINCE")),1),a("p",pe,s(C.value),1)]),a("button",{type:"submit",class:"profile-form__submit",disabled:g.value||!L.value},s(g.value?i(l)("PROFILE.SAVING"):i(l)("PROFILE.SAVE_CHANGES")),9,ve),E.value?(p(),d("p",fe,s(E.value),1)):A("",!0),f.value?(p(),d("p",me,s(i(l)("PROFILE.SAVE_SUCCESS")),1)):A("",!0)],32)])])]))}});export{Re as default};
